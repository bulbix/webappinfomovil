function validaDominio(tipo){var sitioDisponible="",infomovil="infomovil",textoBoton="Aceptar",opcion="NO_PUBLICAR",msjValidacion="",funcion="aceptar()",nombreSitio="",regAuxiliar=/^[_a-z0-9-]+([a-z0-9])$/;return"recurso"==tipo?(nombreDominio=$("#nombreDominioRec").val(),tipoDominio=$("#tipoDominioRec").val()):(nombreDominio=$("#nombreDominioBusqueda").val(),tipoDominio=$("#tipoDominioBusqueda").val()),nombreDominio=nombreDominio.toLowerCase().trim(),null==nombreDominio||0==nombreDominio.trim().length||nombreDominio.trim().length<3||nombreDominio.trim().length>30?($("#validacionNombre").html("El nombre debe ser de una longitud mínimo de 2 y máximo 30 caracteres"),$("#validacionNombreRec").html("El nombre debe ser de una longitud mínimo de 2 y máximo 30 caracteres"),$("#validacionNombre").css("display","block"),$("#validacionNombreRec").css("display","block"),!1):-1!=infomovil.indexOf(nombreDominio.toLowerCase())||-1!=nombreDominio.toLowerCase().indexOf("infomovil")?($("#validacionNombre").html("No debe contener la palabra Infomovil"),$("#validacionNombreRec").html("No debe contener la palabra Infomovil"),$("#validacionNombre").css("display","block"),$("#validacionNombreRec").css("display","block"),!1):regAuxiliar.test(nombreDominio)?($("#validacionNombre").css("display","none"),$("#validacionNombreRec").css("display","none"),$.blockUI({message:"Buscando disponibilidad...",css:{top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}}),void $.ajax({type:"GET",url:contextPath+"/infomovil/existeDominio",dataType:"json",data:{nombreDominio:nombreDominio,tipoDominio:tipoDominio}}).done(function(json){sitioDisponible="recurso"==tipoDominio?"www.infomovil.com/"+nombreDominio:"www."+nombreDominio+"."+tipoDominio,nombreSitio=sitioDisponible.length,nombreSitio>25&&(sitioDisponible=sitioDisponible.substring(4,nombreSitio)),-1!=json.resultado.indexOf("No existe")?(funcion="publicar()",opcion="PUBLICAR",msjValidacion="",textoBoton="&iexcl;Lo quiero!",sitioDisponible="<strong class='textPurple'>"+sitioDisponible+"</strong> <br/>est&aacute; disponible"):(funcion="aceptar()",msjValidacion="",textoBoton="Aceptar",sitioDisponible="<strong class='textPurple'>"+sitioDisponible+"</strong> <br/>no est&aacute; disponible"),$("#modalPublicacion").html("<div id='myModalPublicar' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'><div class='modal-dialog modal-md'><div class='modal-content'><div class='modal-header'><button type='button' class='close textBlack' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div><div class='modal-body'><h2 class='textBlack col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center'>"+msjValidacion+"</h2><span class='textBlack btnsEditor col-xs-12 col-sm-12 col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 text-center'>"+sitioDisponible+"</span><div class='clear divider'></div></div><div class='modal-footer'><button type='button' class='btn btn-purple text-center col-xs-12 col-sm-12 col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 btnsEditor' data-dismiss='modal' onClick="+funcion+"><strong>"+textoBoton+"</strong></button><input type='hidden' id='opcion' value="+opcion+"/></div></div></div></div>"),$("#modalPublicacion > .alert-success").append($("#myModalPublicar").modal("show")),$.unblockUI()}).fail(function(jqXHR,textStatus){$.unblockUI()})):($("#validacionNombre").html("Caracteres no v&aacutelidos"),$("#validacionNombreRec").html("Caracteres no v&aacutelidos"),$("#validacionNombreRec").css("display","block"),$("#validacionNombre").css("display","block"),!1)}function aceptar(){$("#modalPublicacion > .alert-success").append($("#myModalPublicar").modal("remove"))}function publicar(){$("#idCatTipoRecurso").val("1"),$("#nombreDominio").val(nombreDominio.toLowerCase().trim()),$("#tipoDominio").val(tipoDominio.toLowerCase()),$("#modalPublicacion").css("display","none"),$.blockUI({message:"Publicando sitio...",css:{top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}}),$("#publicarDominio").submit()}function actualizaPlantilla(plantillaElegida){var plantillaNueva=plantillaElegida,nombreNegocio=$("#txtNombreNegocio").val(),descripcionCorta=$("#txtDescripcionCorta").val(),correo=$("#txtCorreo").val(),telefono=$("#txtTelefono").val();$("#plantilla").val();$("#modalTemplates").css("display","none"),$.blockUI({message:"Actualizando estilo...",css:{top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}}),$.ajax({type:"GET",url:contextPath+"/infomovil/actualizaPlantilla",dataType:"json",contentType:"text/plain",data:{nombreEmpresa:nombreNegocio,descripcionCorta:descripcionCorta,correoElectronico:correo,telefono:telefono,plantilla:plantillaNueva},success:function(json){$("#plantilla").val(plantillaNueva),"0"==json.actualizaTemplate&&(window.location=contextPath+"/infomovil/editarSitio"),$.unblockUI()},error:function(json){$.unblockUI()}})}function generarSlider(){var urlRecurso="",slider="",span="",li="";for(slider="<ul class='bxslider'>",i=0;i<templates.length;i+=1)urlRecurso="https://s3.amazonaws.com/landing.infomovil.com/webapp/templates/"+templates[i]+"/"+templates[i]+".png",li="<li class='text-center'><img style='width:100%; height:auto; min-width:280px!important; max-width:600px !important; max-height:568px!important;min-height:265px!important; display:block;' src='"+urlRecurso+"' title='"+nombres[i]+"'' /></li>",slider+=li,urlRecurso="";$("#modalTemplates").html("<div id='myModalTemplates' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'><div class='modal-dialog modal-md'><div class='modal-content'><div class='modal-header'><button type='button' class='close textBlack pull-left' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button> <button type='button' class='btn btn-purple pull-right txtBtnEditor' onClick='actualizaEstilo()'>Aplicar estilo</button></div><div class='modal-body'>"+slider+"</div><div class='modal-footer'></div></div></div></div>"),$("#modalTempPromo").html("<div id='myModalTempPromo' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'><div class='modal-dialog modal-md'><div class='modal-content'><div class='modal-header'><button type='button' class='close textBlack pull-left' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button> <button type='button' class='btn btn-purple pull-right txtBtnEditor' onClick='actualizaEstilo()'>Aplicar estilo</button></div><div class='modal-body'>"+slider+"</div><div class='modal-footer'></div></div></div></div>");var slider=$(".bxslider").bxSlider({moveSlides:1,displaySlideQty:2,responsive:!1,adaptiveHeight:!0,mode:"fade",captions:!0,pager:!0,touchEnabled:!0,useCSS:!1,onSlideAfter:function(){indice=slider.getCurrentSlide()},onSliderLoad:function(){$("#plantilla").val()==templates[0]&&(span="<img src='https://s3.amazonaws.com/landing.infomovil.com/webapp/images/temp_act.png' width='30'/>")}});$(document).on("click",".bx-next",function(){indice=slider.getCurrentSlide()}),$(document).on("click",".bx-prev",function(){indice=slider.getCurrentSlide()}),$(document).on("click",".bx-pager-link",function(){indice=slider.getCurrentSlide()})}function plantillaElegida(indicador){var span="<img src='https://s3.amazonaws.com/landing.infomovil.com/webapp/images/temp_inact.png' width='30'/>";$("#plantilla").val()==templates[indicador]&&(span="<img src='https://s3.amazonaws.com/landing.infomovil.com/webapp/images/temp_act.png' width='30'/>"),$("#imgActivo").val(span)}function actualizaEstilo(){actualizaPlantilla(templates[indice])}function autosave(){var n1=$("#txtNombreNegocio").val()+$("#txtDescripcionCorta").val()+$("#txtCorreo").val()+$("#txtTelefono").val(),autosaveForm=function($form,seconds){setTimeout(function(){var n2="",nombreNegocio=$("#txtNombreNegocio").val(),descripcionCorta=$("#txtDescripcionCorta").val(),correo=$("#txtCorreo").val(),telefono=$("#txtTelefono").val();n2=nombreNegocio+descripcionCorta+correo+telefono,n2!=n1?$.ajax({type:"GET",url:contextPath+"/infomovil/guardarInformacion",dataType:"json",contentType:"text/plain",data:{nombreEmpresa:nombreNegocio,descripcionCorta:descripcionCorta,correoElectronico:correo.toLowerCase(),telefono:telefono,plantilla:$("#plantilla").val()},success:function(json){n1=nombreNegocio+descripcionCorta+correo+telefono,autosaveForm($form,seconds)},error:function(json){}}):autosaveForm($form,seconds)},seconds)};autosaveForm($("form"),5e3)}var templates=new Array("Coverpage20","Coverpage19","Coverpage18","Coverpage17","Coverpage16","Coverpage15","Coverpage14","Coverpage13","Coverpage12","Coverpage11","Coverpage10","Coverpage9","Coverpage7","Coverpage8","Coverpage1azul","Coverpage2","Coverpage3","Coverpage4","Coverpage5","Coverpage6"),nombres=new Array("Servicios","Salud","Regalos","Música","Educativo","Legal","Café","Deportes","Florerías","Metrópoli","Nuevos negocios","Pr&oacute;ximamente","Otoño","Vanguardia","Portada azul","Restaurantes","Belleza","Reposter&iacute;as","Automotriz","Taxistas"),nombreDominio="",tipoDominio="",indice=0;$(document).ready(function(){$("#txtTelefono").numeric({negative:!1})}),$("#btnVolante").on("click",function(){window.location=contextPath+"/infomovil/misPromociones"});