function isDevice(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&$(".modal").on("show.bs.modal",function(){$(this).css({position:"fixed",marginTop:"0px",bottom:document.documentElement.scrollHeigh+"px"})})}function testapiFacebook(){var k=0;dfd=new $.Deferred,FB.api("/me/albums?fields=count,name,id,picture",function(response){$(response.data).map(function(){this.count>0&&(infoAlbumes[k]={aid:this.id,title:this.name,count:this.count,picture:this.picture.data.url},k++)});for(var p in infoAlbumes)generaFotos(infoAlbumes[p],p);dfd.resolve()}),dfd.done(function(){logueoFacebook2()})}function generaFotos(idAlbum,p){FB.api("/"+idAlbum.aid+"/photos?fields=images",function(photos){for(var resultTemp=[],j=0;j<photos.data.length;j++)resultTemp[j]={origen:photos.data[j].images[0].source};photosDelAlbum[p]=resultTemp})}function statusChangeCallback(response){"connected"===response.status?testapiFacebook():"not_authorized"===response.status&&FB.login(function(response){statusChangeCallback2(response)},{scope:"public_profile,email,user_photos"})}function statusChangeCallback2(response){"connected"===response.status&&testapiFacebook()}function getImagenesJQ(){if(GRADOS="CW_0",$("#btnGuardarImagen").hide(),$("#actualizarTextoFoto").val(""),$("#nombreDeImgn").val(""),$.blockUI.defaults.baseZ=9e3,$.blockUI({message:"Obteniendo fotos...",css:{"class":"alertaUI",top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}}),IMAGENESDELUSUARIO=0,0==bloqueo1Vez){bloqueo1Vez=1,$("#facebookDiv").hide(),$("#regresarDeFace").hide(),$("#idRegresarAlbum").hide(),$("#btnSeleccionaImagen2").show(),$("#btnAlbumsDeFacebook").show(),$(".imagenDinamica").remove(),$("#imgSeleccionadaDeGaleria").hide(),$("#regresarSelecImg").hide(),$("#terceroFB").hide(),$("#primeroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$("#msjEligeAlbumFoto").hide();var $listaImg=$("#listaImagenes"),weHaveSuccess=!1;$.ajax({type:"GET",url:contextPath+"/infomovil/getImagenes",dataType:"json",contentType:"text/plain",data:{domainId:$("#idDominio").val()},success:function(data){bloqueo1Vez=0;for(var imgSinLogo=0,i=0;i<data.length;i++)"IMAGEN"==data[i].typeImage&&imgSinLogo++;IMAGENESDELUSUARIO=imgSinLogo,IMAGENESDELUSUARIO>0?$("#galeriaVacia").hide():$("#galeriaVacia").show(),siHayImagen=0;for(var i=0;i<data.length;i++){var imgUrl=data[i].url,typeImg=data[i].typeImage,descImg=data[i].descripcionImagen,idImg=data[i].idImagen;if("IMAGEN"==typeImg)if(siHayImagen=1,IMAGENESMAX>=i){var $li=$('<li class="imagenDinamica" style="display:block;height:80px; width:100%; margin:10px 0;"/>');$li.append('<div class="col-xs-3 text-left" style="margin:-5px 0 0 0;" ><div class="img-thumbnail"><div style="max-height:38px; overflow:hidden"><img src="'+imgUrl+'" onerror="errorPreview(this)" class="ImgDinamica imgLista"/></div></div></div>'),$li.append('<div class="col-xs-9 reset"><input type="text" id="actualizarTexto'+idImg+'"  value="'+descImg+'" class="col-xs-5 col-sm-8" style="height:38px"/></input><div class="spaceBtnsMap"></div><button type="button" class="btn btn-purple" class="eliminarImagen" onClick="actualizarImagen('+idImg+", '"+imgUrl+'\')"><img width="20" height="20" alt="Borrar" src="../resources/webapp/images/ico_actualizar.png" /></button><div class="spaceBtnsMap"></div><button type="button" class="btn btn-purple" class="eliminarImagen" id="'+idImg+'"onclick="borrarImagenJQ('+idImg+')"><img width="20" height="20" alt="Borrar" src="../resources/webapp/images/trash.png" /></button><input type="hidden" id="IdImg" value="'+idImg+'"/></div></li>'),$listaImg.append($li)}else{var $li=$('<li class="imagenDinamica" style="display:block;height:80px; width:100%; margin:10px 0;"/>');$li.append('<div class="col-xs-3 text-left" ><div class="img-thumbnail"><div style="max-height:38px; overflow:hidden"><img src="'+imgUrl+'" onerror="errorPreview(this)" class="ImgDinamica img-thumbnail imgLista"/></div>'),$li.append('<div class="col-xs-9 reset"><input type="text" id="actualizarTexto'+idImg+'" value="'+descImg+'" disabled="disabled" class="col-xs-5 col-sm-8" style="height:38px"/><div class="spaceBtnsMap"></div><button type="button" disabled="disabled" class="btn" class="eliminarImagen" onClick="actualizarImagen('+idImg+", '"+imgUrl+'\')"><img width="20" height="20" alt="Borrar" src="../resources/webapp/images/ico_actualizar.png" /></button><div class="spaceBtnsMap"></div><button type="button" disable="disable" class="btn" class="eliminarImagen" id="'+idImg+'"onclick="borrarImagenJQ('+idImg+')"><img width="20" height="20" alt="Borrar" src="../resources/webapp/images/trash.png" /></button><input type="hidden" id="IdImg" value="'+idImg+'"/></div></li>'),$listaImg.append($li)}}1==siHayImagen&&$("#galeriaVacia").hide(),$("#myModalImagenes").modal("show"),$("#galeriaImagenes").show(),$.unblockUI(),weHaveSuccess=!0},error:function(json){bloqueo1Vez=0,$.unblockUI()},complete:function(){weHaveSuccess||alert("Your username/password seems to be incorrect!")}})}}function errorPreview(element){element.onerror="",element.src="../resources/webapp/images/ico_img-gy.png"}function guardarImagenesJQ(){if(IMAGENESMAX>IMAGENESDELUSUARIO){var imageDom=document.getElementById("fotoDeGaleria"),imageUrl=imageDom.src;$.blockUI.defaults.baseZ=9e3,$.blockUI({message:"Guardando la imagen...",css:{"class":"alertaUI",top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}});var textFoto=$("#actualizarTextoFoto").val();uploadImage(imageDom,imageUrl,ORIGIN_USER,textFoto)}else planPro=$("#planPro").val(),visible="display:block;","SI"==planPro&&(visible="display:none;"),BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />Alcanzaste el máximo de fotos permitidas</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">Adquiere <strong>Plan Pro</strong> desde la app para agregar más fotos </p><br/> <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 text-center"><a href="https://itunes.apple.com/mx/app/infomovil/id898313250?mt=8" style="margin: 0px; padding: 0px; color: rgb(49, 165, 154);" target="_blank"><img alt="AppStore" src="../resources/webapp/images/appstore_icn.png" style="margin: 0px; padding: 0px; max-width: 150px;" title="AppStore" /></a></div><div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 text-center"><a href="https://play.google.com/store/apps/details?id=com.infomovil.infomovil" style="margin: 0px; padding: 0px; color: rgb(49, 165, 154);" target="_blank"><img alt="Google Play" src="../resources/webapp/images/gstore_icn.png"  style="margin: 0px; padding: 0px; max-width: 150px;" title="Google Play" /></a></div></div><div class="clearfix"></div><div style="display:block; height:30px; width:100%;"></div>'}),$("#galeriaImagenes").show(),$("#imgSeleccionadaDeGaleria").hide(),$("#regresarSelecImg").hide(),$("#btnGuardarImagen").hide(),$("#btnAlbumsDeFacebook").show(),$("#btnSeleccionaImagen").val(""),$("#actualizarTextoFoto").val("")}function guardarImagenesJQF(){if(IMAGENESMAX>IMAGENESDELUSUARIO){var imageUrl=$("#imgVistaPrevia").attr("src");$.blockUI.defaults.baseZ=9e3,$.blockUI({message:"Guardando la imagen...",css:{"class":"alertaUI",top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}}),convertImgToBase64F(imageUrl,function(base64Img){binaryString=base64Img.replace(/^data:image\/(png|jpeg|jpg);base64,/,"");var textFoto=$("#nombreDeImgn").val(),weHaveSuccess=!1;$.ajax({type:"POST",url:contextPath+"/infomovil/guardarImagen",dataType:"json",contentType:"application/x-www-form-urlencoded",data:{baseImagen:binaryString,tipoImagen:"IMAGEN",domainId:$("#idDominio").val(),descImagen:textFoto,rotacion:GRADOS},success:function(data){$("#facebookDiv").hide(),$("#imgSeleccionadaDeGaleria").hide(),$("#regresarSelecImg").hide(),$("#btnAlbumsDeFacebook").show(),getImagenesJQ(),$("#galeriaImagenes").show(),$("#btnGuardarImagen").hide(),weHaveSuccess=!0,$.unblockUI()},error:function(json){$.unblockUI(),BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />Imagen demasiado grande</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">La imagen ha superado el límite permitido. El límite es de 768x1024 px</p><br/>'}),weHaveSuccess=!0},complete:function(){weHaveSuccess||BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />Imagen demasiado grande</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">La imagen ha superado el límite permitido. El límite es de 768x1024 px</p><br/>'})}})})}else BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />Alcanzaste el máximo de fotos permitidas</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">Adquiere <strong>Plan Pro</strong> desde la app para agregar más fotos </p><br/> <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 text-center"><a href="https://itunes.apple.com/mx/app/infomovil/id898313250?mt=8" style="margin: 0px; padding: 0px; color: rgb(49, 165, 154);" target="_blank"><img alt="AppStore" src="../resources/webapp/images/appstore_icn.png" style="margin: 0px; padding: 0px; max-width: 150px;" title="AppStore" /></a></div><div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 text-center"><a href="https://play.google.com/store/apps/details?id=com.infomovil.infomovil" style="margin: 0px; padding: 0px; color: rgb(49, 165, 154);" target="_blank"><img alt="Google Play" src="../resources/webapp/images/gstore_icn.png"  style="margin: 0px; padding: 0px; max-width: 150px;" title="Google Play" /></a></div></div><div class="clearfix"></div><div style="display:block; height:30px; width:100%;"></div>'})}function convertImgToBase64F(url,callback,outputFormat){var img=new Image;img.crossOrigin="Anonymous",img.onload=function(){var canvas=document.createElement("CANVAS"),ctx=canvas.getContext("2d"),targetWidth=500,ratio=targetWidth>this.width?1:targetWidth/this.width;canvas.height=this.height*ratio,canvas.width=this.width*ratio,ctx.drawImage(this,0,0,this.width,this.height,0,0,canvas.width,canvas.height);var dataURLTemp=canvas.toDataURL(outputFormat||"image/png"),peso=5e5,calidad=peso>dataURLTemp.length?1:peso/dataURLTemp.length,dataURL=canvas.toDataURL({format:"png",quality:calidad});callback(dataURL),canvas=null},img.src=url}function uploadImage(imageDom,imageUrl,origin,textFoto){convertImgToBase64(imageDom,imageUrl,function(base64Img){binaryString=base64Img.replace(/^data:image\/(png|jpeg|jpg);base64,/,"");var weHaveSuccess=!1;$.ajax({type:"POST",url:contextPath+"/infomovil/guardarImagen",dataType:"json",timeout:25e3,contentType:"application/x-www-form-urlencoded",data:{baseImagen:binaryString,tipoImagen:"IMAGEN",domainId:$("#idDominio").val(),descImagen:textFoto,rotacion:GRADOS},success:function(data){weHaveSuccess=!0,origin==ORIGIN_FACEBOOK?($("#facebookDiv").hide(),$("#imgSeleccionadaDeGaleria").hide(),$("#regresarSelecImg").hide(),$("#btnAlbumsDeFacebook").show(),getImagenesJQ(),$("#galeriaImagenes").show(),$("#btnGuardarImagen").hide()):($("#msjEligeFotoAlbum").hide(),$("#msjEligeAlbumFoto").hide(),$("#facebookDiv").hide(),$("#imgSeleccionadaDeGaleria").hide(),$("#regresarSelecImg").hide(),$("#btnAlbumsDeFacebook").show(),$("#btnSeleccionaImagen").val(""),$("#actualizarTextoFoto").val(""),getImagenesJQ(),$("#galeriaImagenes").show(),$("#btnGuardarImagen").hide()),$.unblockUI()},error:function(json,t){$.unblockUI(),"timeout"===t?BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />Se agoto el tiempo de espera</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">Por favor intentalo nuevamente.</p><br/>'}):BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />Imagen demasiado grande</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">La imagen ha superado el límite permitido. El límite es de 768x1024 px</p><br/>'}),weHaveSuccess=!0},complete:function(){weHaveSuccess||BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />Imagen demasiado grande</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">La imagen ha superado el límite permitido. El límite es de 768x1024 px</p><br/>'})}})})}function borrarImagenJQ(idImg){BootstrapDialog.show({title:'<div class="textBlack">Borrar Imagen</div>',message:'<div style="display:block; padding: 10px;">¿Seguro que deseas borrar la imagen?</div>',buttons:[{label:"Cancelar",action:function(dialog){dialog.close()}},{label:"Aceptar",action:function(dialog){dialog.close(),$.blockUI.defaults.baseZ=9e3,$.blockUI({message:"Eliminando la imagen...",css:{"class":"alertaUI",top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}});var weHaveSuccess=!1;$.ajax({type:"GET",url:contextPath+"/infomovil/borrarImagen",dataType:"json",contentType:"text/plain",data:{domainId:$("#idDominio").val(),imageId:idImg},success:function(data){$.unblockUI(),getImagenesJQ(),weHaveSuccess=!0},error:function(json){$.unblockUI(),BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />No se ha eliminado la imagen</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">Intenta eliminar la imagen nuevamente.</p><br/>'}),weHaveSuccess=!0},complete:function(){weHaveSuccess||BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />No se ha eliminado la imagen</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">Intenta eliminar la imagen nuevamente.</p><br/>'})}})}}]})}function actualizarImagen(idImg,imgUrl){$.blockUI.defaults.baseZ=9e3,$.blockUI({message:"Actualizando imagen...",css:{"class":"alertaUI",top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}});var weHaveSuccess=!1;$.ajax({type:"GET",url:contextPath+"/infomovil/actualizarImagen",dataType:"json",contentType:"text/plain",data:{domainId:$("#idDominio").val(),imageId:idImg,baseImagen:"",descImagen:$("#actualizarTexto"+idImg).val()},success:function(data){$.unblockUI(),getImagenesJQ(),weHaveSuccess=!0},error:function(json){$.unblockUI(),BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />No se ha actualizado el nombre de la imagen</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">Intenta actualizar el nombre de la imagen nuevamente.</p><br/>'}),weHaveSuccess=!0},complete:function(){weHaveSuccess||BootstrapDialog.show({title:"<span class='textBlack' style='font-size:1.15em;'><img alt='' src='../resources/webapp/images/fa-warning-bk.png'  title='Alerta' />No se ha actualizado el nombre de la imagen</span>",message:'<div style="display:block; min-height:150px;"><p class="textBlack text-center" style="font-size:1.15em;">Intenta actualizar el nombre de la imagen nuevamente.</p><br/>'})}})}function picChange(evt){var $imageDomFotoDeGaleria=document.getElementById("fotoDeGaleria"),fileInput=evt.target.files;if(fileInput.length>0){var file=fileInput[0];if(file){var picURL;$("#facebookDiv").hide(),$("#galeriaImagenes").hide(),$("#galeriaVacia").hide(),$("#imgSeleccionadaDeGaleria").show(),$("#regresarSelecImg").show(),$("#btnGuardarImagen").show(),$("#btnAlbumsDeFacebook").hide(),$("#btnSeleccionaImagen2").hide();var reader=new FileReader;try{reader.onload=function(){$imageDomFotoDeGaleria.src=reader.result},reader.readAsDataURL(file)}catch(err){picURL=window.webkitURL?window.webkitURL.createObjectURL(file):window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(file):null,$imageDomFotoDeGaleria.src=picURL}reader.onload=function(){$imageDomFotoDeGaleria.src=reader.result,imageDom=document.getElementById("fotoDeGaleria");var img=new Image;switch(img.src=imageDom.src,EXIF.getData(img,function(){}),parseInt(EXIF.getTag(img,"Orientation"))){case 8:$imageDomFotoDeGaleria.css({transform:"rotate(270deg)","-ms-transform":"rotate(270deg)","-webkit-transform":"rotate(270deg)","-o-transform":"rotate(270deg)","-moz-transform":"rotate(270deg)"});break;case 3:$imageDomFotoDeGaleria.css({transform:"rotate(180deg)","-ms-transform":"rotate(180deg)","-webkit-transform":"rotate(180deg)","-o-transform":"rotate(180deg)","-moz-transform":"rotate(180deg)"});break;case 6:$imageDomFotoDeGaleria.css({transform:"rotate(90deg)","-ms-transform":"rotate(90deg)","-webkit-transform":"rotate(90deg)","-o-transform":"rotate(90deg)","-moz-transform":"rotate(90deg)"});break;default:GRADOS="CW_0"}}}}}function convertImgToBase64(imageDom,url,callback,outputFormat){var resize1=function(){var dataURLTemp="",canvas=document.createElement("CANVAS"),ctx=canvas.getContext("2d"),targetWidth=420;url.length<=0&&(imageDom.src=$imageDomFotoDeGaleria.src);var ratio=targetWidth>imageDom.naturalWidth?1:targetWidth/imageDom.naturalWidth,img=new Image;switch(img.src=url,EXIF.getData(img,function(){}),parseInt(EXIF.getTag(img,"Orientation"))){case 8:/iPhone|iPad|iPod/i.test(navigator.userAgent)?(GRADOS="CW_0",canvas.height=imageDom.naturalHeight*ratio,canvas.width=imageDom.naturalWidth*ratio,ctx.transform(0,1,-1,0,canvas.height,0),ctx.transform(0,1,-1,0,canvas.width,0),ctx.transform(0,1,-1,0,canvas.height,0),ctx.drawImage(imageDom,0,0,imageDom.naturalWidth,imageDom.naturalHeight,0,0,canvas.height,canvas.height),dataURLTemp=canvas.toDataURL({format:"image/png"})):(GRADOS="CW_270",canvas.height=imageDom.naturalHeight*ratio,canvas.width=imageDom.naturalWidth*ratio,ctx.drawImage(imageDom,0,0,imageDom.naturalWidth,imageDom.naturalHeight,0,0,canvas.width,canvas.height),dataURLTemp=canvas.toDataURL({format:"image/png"}));break;case 3:GRADOS="CW_180",canvas.height=imageDom.naturalHeight*ratio,canvas.width=imageDom.naturalWidth*ratio,ctx.drawImage(imageDom,0,0,imageDom.naturalWidth,imageDom.naturalHeight,0,0,canvas.width,canvas.height),dataURLTemp=canvas.toDataURL({format:"image/png"});break;case 6:/iPhone|iPad|iPod/i.test(navigator.userAgent)?(GRADOS="CW_0",canvas.height=imageDom.naturalHeight*ratio,canvas.width=imageDom.naturalWidth*ratio,ctx.transform(0,1,-1,0,canvas.width,0),ctx.drawImage(imageDom,0,0,imageDom.naturalWidth,imageDom.naturalHeight,0,0,canvas.height,canvas.height),dataURLTemp=canvas.toDataURL({format:"image/png"})):(GRADOS="CW_90",canvas.height=imageDom.naturalHeight*ratio,canvas.width=imageDom.naturalWidth*ratio,ctx.drawImage(imageDom,0,0,imageDom.naturalWidth,imageDom.naturalHeight,0,0,canvas.width,canvas.height),dataURLTemp=canvas.toDataURL({format:"image/png"}));break;default:GRADOS="CW_0",canvas.height=540*imageDom.height/imageDom.width,canvas.width=560,ctx.drawImage(imageDom,0,0,560,540*imageDom.height/imageDom.width),dataURLTemp=canvas.toDataURL({format:"image/png"})}var peso=5e5,calidad=peso>dataURLTemp.length?1:peso/dataURLTemp.length;return canvas.toDataURL({format:"png",quality:calidad})},resize2=function(){var canvas=document.createElement("CANVAS"),ctx=canvas.getContext("2d"),targetWidth=420,ratio=targetWidth>imageDom.naturalWidth?1:targetWidth/imageDom.naturalWidth;canvas.height=imageDom.naturalHeight*ratio,canvas.width=imageDom.naturalWidth*ratio,ctx.drawImage(imageDom,0,0,imageDom.naturalWidth,imageDom.naturalHeight,0,0,canvas.width,canvas.height);var dataURLTemp=canvas.toDataURL({format:"image/png"}),peso=5e5,calidad=peso>dataURLTemp.length?1:peso/dataURLTemp.length;return canvas.toDataURL({format:"png",quality:calidad})};if("data:"==url.substring(0,5)){var dataURL=resize1();callback(dataURL),canvas=null}else{var img=new Image;img.crossOrigin="Anonymous",img.onload=function(){var dataURL=resize2();callback(dataURL),canvas=null},img.src=url}}function logueoFacebook(response){if("connected"===response.status){$("#btnAlbumsDeFacebook").hide(),$("#btnSeleccionaImagen2").hide(),$("#terceroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$("#galeriaImagenes").hide(),$(".albumDinamico").remove(),$("#facebookDiv").show(),$("#primeroFB").show(),$("#msjEligeAlbumFoto").show(),$("#regresarDeFace").show(),$("#segundoFB").hide(),$("#galeriaVacia").hide(),$("#msjEligeFotoAlbum").hide(),$("#idRegresarAlbum").hide(),$("#nombreDeImgn").val("");for(var p in infoAlbumes){var $photosList=$("#albumsList"),$li=$('<li class="albumDinamico" style="display:block; height:100px; margin:0 5px 5px 5px;"/>');$li.append('<span class="col-xs-4"><img src="'+infoAlbumes[p].picture+'" class="img-thumbnail imgListaBig"/></span>'),$li.append('<span class="col-xs-8"><strong style="color:#7c41bc" class="hidden-xs"> Album:</strong> '+infoAlbumes[p].title+'<img alt="" src="../resources/webapp/images/ir.png" style="max-width:23px; max-height:23px;" title="Ir" class="pull-right"/></span>'),$li.click(function(){$.blockUI.defaults.baseZ=9e3,$.blockUI({message:"Obteniendo fotos...",css:{"class":"alertaUI",top:($(window).height()-400)/2+"px",left:($(window).width()-400)/2+"px",width:"400px"}});var r=$(this).index();$(".photoDinamico").remove(),$("#primeroFB").hide(),$("#msjEligeAlbumFoto").hide(),$("#regresarDeFace").hide(),$("#segundoFB").show(),$("#msjEligeFotoAlbum").show(),$("#idRegresarAlbum").show(),$("#terceroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$("#galeriaVacia").hide();var fotos=photosDelAlbum[r];for(var a in fotos){var $photosList=$("#photosList"),$li=$('<div class="photoDinamico" style="display:block; height:100px; margin:10px 5px; max-width:100px; float:left "/>');$li.append('<span class="col-xs-12"><img src="'+fotos[a].origen+'"  class="img-thumbnail imgListaBig"/></span>'),$li.on("click","img",function(){$("#imgVistaPrevia").attr("src",$(this).attr("src")),$("#primeroFB").hide(),$("#msjEligeAlbumFoto").hide(),$("#regresarDeFace").hide(),$("#segundoFB").hide(),$("#msjEligeFotoAlbum").hide(),$("#idRegresarAlbum").hide(),$("#terceroFB").show(),$("#regresarDeFotos").show(),$("#btnGuardarImagenFB").show()}),$photosList.append($li)}$.unblockUI()}),$photosList.append($li)}}else navigator.userAgent.match("CriOS")?window.open("https://www.facebook.com/dialog/oauth?client_id=346859792130678&scope=email,user_photos&redirect_uri="+document.location.href,"",null):FB.login(function(response){statusChangeCallback(response)},{scope:"public_profile,email,user_photos"})}function logueoFacebook2(){$("#btnAlbumsDeFacebook").hide(),$("#btnSeleccionaImagen2").hide(),$("#terceroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$("#galeriaImagenes").hide(),$(".albumDinamico").remove(),$("#facebookDiv").show(),$("#primeroFB").show(),$("#msjEligeAlbumFoto").show(),$("#regresarDeFace").show(),$("#segundoFB").hide(),$("#galeriaVacia").hide(),$("#msjEligeFotoAlbum").hide(),$("#idRegresarAlbum").hide(),$("#nombreDeImgn").val("");for(var p in infoAlbumes){var $photosList=$("#albumsList"),$li=$('<li class="albumDinamico" style="display:block; height:100px; margin:0 5px 5px 5px;"/>');$li.append('<span class="col-xs-4"><img src="'+infoAlbumes[p].picture+'"  class="img-thumbnail imgListaBig"/></span>'),$li.append('<span class="col-xs-8"><strong style="color:#7c41bc" class="hidden-xs"> Album:</strong> '+infoAlbumes[p].title+' <img alt="" src="../resources/webapp/images/ir.png" style="max-width:23px; max-height:23px;" title="Ir" class="pull-right"/></span><br/>'),$li.click(function(){var r=$(this).index();$(".photoDinamico").remove(),$("#primeroFB").hide(),$("#msjEligeAlbumFoto").hide(),$("#regresarDeFace").hide(),$("#segundoFB").show(),$("#msjEligeFotoAlbum").show(),$("#idRegresarAlbum").show(),$("#terceroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$("#galeriaVacia").hide();var fotos=photosDelAlbum[r];for(var a in fotos){var $photosList=$("#photosList"),$li=$('<div class="photoDinamico" style="display:block; height:100px; margin:10px 5px; max-width:100px; float:left "/>');$li.append('<span class="col-xs-12"><img src="'+fotos[a].origen+'"  class="img-thumbnail imgLista"/></span>'),$li.on("click","img",function(){$("#imgVistaPrevia").attr("src",$(this).attr("src")),$("#primeroFB").hide(),$("#msjEligeAlbumFoto").hide(),$("#regresarDeFace").hide(),$("#segundoFB").hide(),$("#msjEligeFotoAlbum").hide(),$("#idRegresarAlbum").hide(),$("#terceroFB").show(),$("#regresarDeFotos").show(),$("#btnGuardarImagenFB").show()}),$photosList.append($li)}}),$photosList.append($li)}}var bloqueo1Vez=0,planPro="",visible="",IMAGENESMAX=$("#galeriaImagenesMax").val(),IMAGENESDELUSUARIO=0,infoAlbumes=[],photosDelAlbum=[],siHayImagen=0,ORIGIN_USER=1,ORIGIN_FACEBOOK=2,GRADOS="CW_0";$(document).ready(function(){isDevice(),$("#terceroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$(".albumDinamico").remove(),$("#segundoFB").hide(),$("#msjEligeFotoAlbum").hide(),$("#idRegresarAlbum").hide(),$("#galeriaVacia").hide(),$("#imgSeleccionadaDeGaleria").hide(),$("#regresarSelecImg").hide(),$("#facebookDiv").hide(),$("#primeroFB").hide(),$("#msjEligeAlbumFoto").hide(),$("#regresarDeFace").hide();var $btnAlbumsDeFacebook=$("#btnAlbumsDeFacebook").show();$("#btnGuardarImagen").hide(),$btnAlbumsDeFacebook.click(function(e){FB.getLoginStatus(function(response){logueoFacebook(response)})}),$("#idRegresarAlbum").click(function(){$(".photoDinamico").remove(),$("#terceroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$("#segundoFB").hide(),$("#msjEligeFotoAlbum").hide(),$("#idRegresarAlbum").hide(),$("#primeroFB").show(),$("#msjEligeAlbumFoto").show(),$("#regresarDeFace").show(),$("#galeriaVacia").hide()}),$("#idCloseImgFace").click(function(){$("#imgVistaPrevia").attr("src","")}),$("#llamarGaleriaImagenes").click(function(){$("#galeriaImagenes").show(),$("#buscarImagenes").hide(),$("#facebookDiv").hide(),$("#actualizarImagenes").hide(),$("#myModalImagenes").modal(),$("#btnAlbumsDeFacebook").show()}),$("#closemyModalImagenes").click(function(){$("#myModalImagenes").modal("toggle"),$("#galeriaImagenes").hide()}),$("#regresarSelecImg").click(function(){$("#galeriaImagenes").show(),$("#imgSeleccionadaDeGaleria").hide(),$("#regresarSelecImg").hide(),$("#btnGuardarImagen").hide(),$("#btnAlbumsDeFacebook").show(),$("#btnSeleccionaImagen").val(""),$("#actualizarTextoFoto").val("")}),$("#regresarDeFace").click(function(){$("#facebookDiv").hide(),$(".albumDinamico").remove(),$(".photoDinamico").remove(),$("#galeriaImagenes").show(),$("#btnAlbumsDeFacebook").show(),$("#regresarDeFace").hide(),$("#msjEligeAlbumFoto").hide(),1==siHayImagen?$("#galeriaVacia").hide():$("#galeriaVacia").show()}),$("#regresarDeFotos").click(function(){$("#terceroFB").hide(),$("#regresarDeFotos").hide(),$("#btnGuardarImagenFB").hide(),$("#segundoFB").show(),$("#msjEligeFotoAlbum").show(),$("#idRegresarAlbum").show()})}),window.fbAsyncInit=function(){FB.init({appId:"346859792130678",cookie:!0,xfbml:!0,version:"v2.0"}),FB.getLoginStatus(function(response){statusChangeCallback(response)})},function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="https://connect.facebook.net/en_US/all.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","facebook-jssdk");var revisarEstado=function(){FB.getLoginStatus(function(response){statusChangeCallback(response)})};