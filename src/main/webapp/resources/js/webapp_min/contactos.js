var app=angular.module("InfomovilApp",[]);app.controller("ToolBarContactoController",function($scope,$http,ContactoService,MensajesService){var toolbarContacto=this,itemsInicio="",itemsFin="";toolbarContacto.descripcion="descrito",toolbarContacto.downgrade="",toolbarContacto.contacto="",toolbarContacto.tipoPlan="",toolbarContacto.claseLi="",toolbarContacto.contactos="",toolbarContacto.imagenIco="",$scope.order=!1,toolbarContacto.agregaContacto=function(downgrade,contacto,tipoPlan){var limite="0";if(ContactoService.setContactosPermitidos(contacto),toolbarContacto.contactos.length>=contacto&&(limite="1"),"1"==limite){var mensaje="<div style='display:block; min-height:150px;' class='col-xs-12'><p class='textBlack'>Ya has registrado todos los contactos disponibles</p><br/> </div><div class='clearfix'></div><div style='display:block; height:30px; width:100%;'></div>";if("DOWNGRADE"==downgrade&&toolbarContacto.contactos.length>contacto||"Gratuito"==tipoPlan)var mensaje="<div style='display:block; min-height:150px;' class='col-xs-12'><p class='textBlack'>Ya has registrado todos los contactos disponibles</p><p class='textBlack text-center' style='font-size:1.15em;'>Adquiere <strong>Plan Pro</strong> en la sección <img alt='' src='../resources/webapp/images/fa-user-bk.png' width='20' title='Mi Cuenta' /> Mi Cuenta para agregar más contactos </p><br/> </div><div class='clearfix'></div><div style='display:block; height:30px; width:100%;'></div>";return void MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)}$("#numeroEmailRedSocial").keydown(function(e){$("#msgValidaRegExp").css("display","none")}),$("#menuContactos").show(),$("#formGuardaContacto").hide(),$("#mostrarBtnGuardar").hide(),$("#mostrarBtnRegresar").hide(),$("#numeroEmailRedSocial").val(""),$("#descContacto").val(""),$("#myModalContactos").modal()},toolbarContacto.getContenidoDowngrade=function(downgrade,index,contacto,item){var tipoContactoLista="",mensajesContactoLista="",tipoBusqueda="redSocial",llaveBusqueda=item.subCategory,contenidoFinalContacto=item.regExp;if($scope.claseBotonOrd="btn btn-outlineGreen btnOrdenar handle",$scope.contactoDowngrade="1",$scope.contenidoContacto="",item.servicesNaptr.trim().length>0&&0==item.subCategory.trim().length)var tipoBusqueda="tel",llaveBusqueda=item.servicesNaptr;tipoContactoLista=ContactoService.getTipoContacto(tipoBusqueda,llaveBusqueda),mensajesContactoLista=ContactoService.getObjetoTipoContacto(tipoContactoLista),$scope.imagenIco=mensajesContactoLista.imagenIco,void 0!=mensajesContactoLista.tipo&&(contenidoFinalContacto=item.regExp.substring(mensajesContactoLista.tipo.length,item.regExp.length),-1!=mensajesContactoLista.tipo.indexOf("tel")&&(contenidoFinalContacto=item.regExp.substring(mensajesContactoLista.tipo.length+mensajesContactoLista.pais.length,item.regExp.length))),"DOWNGRADE"==downgrade&&index>contacto&&($scope.contactoDowngrade="0",$scope.imagenIco=mensajesContactoLista.imagenIco.replace("-bk",""),$scope.claseBotonOrd="btn btn-outlineGreen btnOrdenar"),$scope.tipoContactoLis=void 0!=mensajesContactoLista.tipo?mensajesContactoLista.tipo:"",$scope.codigoPaisLis=void 0!=mensajesContactoLista.pais?mensajesContactoLista.pais:"",$scope.contenidoContacto=contenidoFinalContacto;var tipoBusqueda="",llaveBusqueda=""},toolbarContacto.abrirActualizarContacto=function(item){var mensajesContacto="",tipoContactoAct="",expReg="",placeHolder="",contenidoContacto="",tipoBusqueda="redSocial",protocolo="",images="",msjValidacionExp="",llaveBusqueda=item.subCategory;if("0"!=item.downgrade){if(item.servicesNaptr.trim().length>0&&0==item.subCategory.trim().length)var tipoBusqueda="tel",llaveBusqueda=item.servicesNaptr;tipoContactoAct=ContactoService.getTipoContacto(tipoBusqueda,llaveBusqueda),mensajesContacto=ContactoService.getObjetoTipoContacto(tipoContactoAct),expReg=void 0!=mensajesContacto.expRegular?mensajesContacto.expRegular:"^\\d{10}$",placeHolder=void 0!=mensajesContacto.placeholder?mensajesContacto.placeholder:"Número Telefónico Inválido. Deben ser 10 Digitos",protocolo=void 0!=mensajesContacto.protocolo?mensajesContacto.protocolo:"",msjValidacionExp=void 0!=mensajesContacto.msjValidacion?mensajesContacto.msjValidacion:"Número Telefónico Inválido. Deben ser 10 Digitos",contenidoContacto=item.regExp,$scope.imagenIco=mensajesContacto.imagenIco,void 0!=mensajesContacto.tipo&&(contenidoContacto=item.regExp.substring(mensajesContacto.tipo.length,item.regExp.length),-1!=mensajesContacto.tipo.indexOf("tel")&&(contenidoContacto=item.regExp.substring(mensajesContacto.tipo.length+mensajesContacto.pais.length,item.regExp.length))),images=$("#rutaIcono").attr("src"),images+=mensajesContacto.imagenIco,$("#paisActualizarTel").text(""),$("#nombreActualizarTel").text(mensajesContacto.nombre),$("#etiquetaActualizarTel").text(mensajesContacto.etiqueta),$("#paisActualizarTel").text(mensajesContacto.pais),$("#inputTelefonosActualizar").val(contenidoContacto),$("#textAreaActualizarTel").val(item.longLabelNaptr),$("#visibleC").val(item.visible),$("#tipoContactoActualizar").val(mensajesContacto.tipo),$("#protocolo").val(protocolo),$("#msgValidaRegExpAct").text(msjValidacionExp),$("#inputTelefonosActualizar").attr("pattern",expReg),$("#inputTelefonosActualizar").attr("placeholder",placeHolder),$("#imgIcono").val(mensajesContacto.imagenIco),$("#rutaIcono").attr("src",images),ContactoService.setRegExp(expReg),ContactoService.setItemGlobal(item),$("#myModalContactosActualizar").modal()}};var ordenarContactos=function(itemsFin){var mensaje="Actualizando contactos...",strInicio="<l>",strFinal="";for(i=0;i<itemsFin.length;i++)strFinal=strFinal+"<f><i>"+itemsFin[i]+"</i><p>"+i+"</p></f>";strFinal=strInicio+strFinal+"</l>",MensajesService.abrirBlockUIGeneral(mensaje),$http({method:"POST",url:contextPath+"/infomovil/setOrderContacts",params:{xml:strFinal}}).then(function(response){mensaje="",0==response.data.codeError?ContactoService.getContactos():mensaje="No se han podido actualizar los contactos",MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)},function(response){mensaje="No se han podido actualizar los contactos",MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)})};$scope.$watch(function(){return ContactoService.contactos()},function(value){toolbarContacto.contactos=value;var arr=value instanceof Array?value:[value];ContactoService.setContactosGuardados(arr.length),ContactoService.getContactosGuardados()<=1?$(".btnOrdenar").removeClass("handle"):$(".btnOrdenar").addClass("handle")}),ContactoService.getContactos(),$("#sortable").sortable({handle:".handle",start:function(event,ui){itemsInicio=$("#sortable").sortable("toArray")}}),$("#sortable").sortable({update:function(event,ui){itemsFin=$("#sortable").sortable("toArray"),itemsInicio!=itemsFin&&ordenarContactos(itemsFin)}})}),app.controller("TipoContacto",function($scope,$http,ContactoService,MensajesService){var datosTipoContacto=this;$("#mostrarBtnGuardar").hide(),$("#mostrarBtnRegresar").hide(),datosTipoContacto.muestraMsjValidacion=!1,datosTipoContacto.tipo=function(tipo){var mensajesContacto=ContactoService.getObjetoTipoContacto(tipo);$("#menuContactos").hide(),$("#formGuardaContacto").show(),$("#mostrarBtnGuardar").show(),$("#mostrarBtnRegresar").show(),datosTipoContacto.muestraPais=mensajesContacto.muestraPais,$scope.nombre=mensajesContacto.nombre,$scope.placeholderContenido=mensajesContacto.placeholder,$scope.mensajeTelefonos=void 0!=mensajesContacto.mensaje?mensajesContacto.mensaje:"",$scope.expRegularValida=void 0!=mensajesContacto.expRegular?mensajesContacto.expRegular:"^\\d{10}$",$scope.pais=void 0!=mensajesContacto.pais?mensajesContacto.pais:"",$scope.etiqueta=void 0!=mensajesContacto.etiqueta?mensajesContacto.etiqueta:"Número Telefónico",$scope.subCategory=void 0!=mensajesContacto.subcategoria?mensajesContacto.subcategoria:"",$scope.servicio=void 0!=mensajesContacto.servicio?mensajesContacto.servicio:"E2U+web:http",$scope.msjValidacion=void 0!=mensajesContacto.msjValidacion?mensajesContacto.msjValidacion:"Número Telefónico Inválido. Deben ser 10 digitos",$scope.maxlength=void 0!=mensajesContacto.maxlength?mensajesContacto.maxlength:"255",$scope.tipoContacto=void 0!=mensajesContacto.tipo?mensajesContacto.tipo:"",$scope.imagenIco=mensajesContacto.imagenIco,$scope.protocolo=void 0!=mensajesContacto.protocolo?mensajesContacto.protocolo:""},datosTipoContacto.regresarAgregarContacto=function(){regresarGenerico()},datosTipoContacto.guardarContacto=function(){var regex=null;if(ContactoService.getContactosGuardados()==ContactoService.getContactosPermitidos()){var mensaje="<div style='display:block; min-height:150px;' class='col-xs-12'><p>Ya has registrado todos los contactos disponibles</p><p class='textBlack text-center' style='font-size:1.15em;'>Adquiere <strong>Plan Pro</strong> en la sección <img alt='' src='../resources/webapp/images/fa-user-bk.png' width='20' title='Mi Cuenta' /> Mi Cuenta para agregar más contactos </p><br/> </div><div class='clearfix'></div><div style='display:block; height:30px; width:100%;'></div>";return void MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)}if(regex=new RegExp($scope.expRegularValida),!regex.test($scope.contacto.numeroEmailRedSocial))return void $("#msgValidaRegExp").css("display","block");$("#msgValidaRegExp").css("display","none");var contacto={longLabelNaptr:void 0!=$scope.contacto.longLabelNaptr?$scope.contacto.longLabelNaptr:"",numeroEmailRedSocial:$scope.contacto.numeroEmailRedSocial,protocolo:$scope.protocolo};guardarContacto(contacto)},datosTipoContacto.closeMyModalContactos=function(){$("#myModalContactos").modal("toggle")};var regresarGenerico=function(){$("#menuContactos").show(),$("#formGuardaContacto").hide(),$("#mostrarBtnGuardar").hide(),$("#mostrarBtnRegresar").hide(),$scope.contacto.longLabelNaptr="",$scope.contacto.numeroEmailRedSocial=""},guardarContacto=function(contacto){var mensaje="Guardando contacto...";MensajesService.abrirBlockUIGeneral(mensaje),$http({method:"POST",url:contextPath+"/infomovil/guardarContacto",params:{descripcionContacto:contacto.longLabelNaptr,numeroEmailRedSocial:contacto.numeroEmailRedSocial.toLowerCase(),constanteContacto:$scope.servicio,redSocialWebSecure:$scope.subCategory,tipoContacto:$scope.tipoContacto,codigoPais:$scope.pais,protocolo:$scope.protocolo}}).then(function(response){mensaje="",0==response.data.codeError?($("#numeroEmailRedSocial").val(""),$("#longLabelNaptr").val(""),ContactoService.getContactos(),regresarGenerico(),$("#myModalContactosActualizar").is(":visible")&&$("#myModalContactosActualizar").modal("toggle"),$("#myModalContactos").is(":visible")&&$("#myModalContactos").modal("hide")):mensaje="No se ha podido guardar el contacto",MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)},function(response){mensaje="No se ha podido guardar el contacto",MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)})}}),app.controller("ActualizarContactos",function($scope,$http,ContactoService,MensajesService){var actualizarTipoContacto=this;actualizarTipoContacto.claseBoton="btn btn-outlineGreen textWhite navEditorLato",actualizarTipoContacto.claseBotonOrd="btn-outlineDisable",actualizarTipoContacto.claseLi="ui-state-default textBlack claseCursorLi",actualizarTipoContacto.claseCheck="onoffswitch-label",$("#myModalContactosActualizar").on("hidden.bs.modal",function(){$("#rutaIcono").attr("src","/resources/webapp/images/")}),actualizarTipoContacto.eliminarContacto=function(item){var item=ContactoService.getItemGlobal(),textos={titulo:"Borrar Contacto",mensaje:"¿Seguro que deseas borrar el contacto?"};MensajesService.obtenerConfirmacion(textos,function(confirmarBorrar){confirmarBorrar&&eliminarContacto(item.claveContacto)})};var eliminarContacto=function(claveContacto){var mensaje="Eliminando contacto...";MensajesService.abrirBlockUIGeneral(mensaje),$http({method:"POST",url:contextPath+"/infomovil/eliminarContacto",params:{claveDeContacto:claveContacto}}).then(function(response){mensaje="",0==response.data.codeError?(ContactoService.getContactos(),$("#myModalContactosActualizar").modal("toggle")):mensaje="No se ha podido eliminar el contacto",MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)},function(response){mensaje="No se ha podido eliminar el contacto",MensajesService.cerrarBlockUIGeneral("Contactos",mensaje)})};actualizarTipoContacto.closeMyModalActualizarContactos=function(){$("#myModalContactosActualizar").modal("toggle")},actualizarTipoContacto.guardarDatosContacto=function(){var item=ContactoService.getItemGlobal(),exp=ContactoService.getRegExp(),regexAct=new RegExp(exp);if(!regexAct.test($("#inputTelefonosActualizar").val()))return void $("#msgValidaRegExpAct").css("display","block");$("#msgValidaRegExpAct").css("display","none");var contacto={claveContacto:item.claveContacto,servicesNaptr:item.servicesNaptr,subCategory:item.subCategory,longLabelNaptr:$("#textAreaActualizarTel").val(),regExp:$("#inputTelefonosActualizar").val(),visible:1==$("#checkVisible").prop("checked")?1:0,tipoContacto:$("#tipoContactoActualizar").val(),codigoPais:$("#paisActualizarTel").text(),protocolo:$("#protocolo").val()};ContactoService.actualizarContacto(contacto),$("#myModalContactosActualizar").modal("toggle")},$("#myModalContactosActualizar").on("shown.bs.modal",function(){var item=ContactoService.getItemGlobal();"1"==item.visible?$("#checkVisible").prop("checked",!0):$("#checkVisible").prop("checked",!1)})});